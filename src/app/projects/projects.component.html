
<div class="app-panel shadow">
    <!-- <h3 class="panel-header">Projekty</h3> -->
    
    <!-- TODO: ustawić odpowiednio styl do filtra -->
    <div class="filter-controls">
      <input class="project-filter filter border" placeholder="Wyszukaj projekt"
      (input)='getModel().filterProject($event.target.value)'>
      <div id="project-filter-button" class="button filter-button" (click)="getState().toggleFilteringOpen()"></div>
    </div>

    <div class="filter-container" *ngIf="getState().isFilteringOpen()">
      <ng-container [ngTemplateOutlet]="filter_container"></ng-container>
    </div>
  
    <div id="special-lists-container" class="transparent-border expansion-list"> 
      <div [ngTemplateOutlet]="special_lists"></div>
    </div>
    
    <div id="projects-container" 
      [ngClass]="{
        'projects-container': getState().isProjectsListOpen(),
        'hidden-list': !getState().isProjectsListOpen(),
        'transparent-border':true,
        'expansion-list':true
      }">
      <div [ngTemplateOutlet]="project_lists_container"></div>
    </div>
</div>

<mat-menu #menu="matMenu">
    <button mat-menu-item (click)="onEditProject()">
      Edytuj
    </button>
    <button mat-menu-item (click)="getRemoving().onRemoveProject()">
      Usuń
    </button>
    <button mat-menu-item (click)="openKanban()">
      Otwórz tablice
    </button>
</mat-menu>

<ng-template #filter_container>
  <div class="filter-group">
    <label class="filter-label">Z datą zakończenia</label>
    <input class="filter-value" type='checkbox' 
    [checked]="getFiltering().getModel().isWithEndDate()" (change)="getFiltering().getModel().setWithEndDate($event.target.checked)">
  </div>

  <div class="filter-group">
    <label class="filter-label">Stan</label>
    <select class="filter-value" 
    [ngModel]="getFiltering().getModel().getStatus()" (ngModelChange)="getFiltering().getModel().setStatus($event)">
      <option [ngValue]="null" >Wszystkie</option>
      <option [ngValue]="status.STARTED">Aktywne</option>
      <option [ngValue]="status.ENDED">Zakończone</option>
      <option [ngValue]="status.AWAITING">Oczekujące</option>
      <option [ngValue]="status.CANCELED">Zakończone</option>
    </select>
  </div>
  
  <div class="filter-group">
    <label class="filter-label">Typ</label>
    <select class="filter-value" 
    [ngModel]="getFiltering().getModel().getProjectType()" (ngModelChange)="getFiltering().getModel().setProjectType($event)">
      <option [ngValue]="null">Wszystkie</option>
      <option [ngValue]="type.SMALL">Małe</option>
      <option [ngValue]="type.MEDIUM">Średnie</option>
      <option [ngValue]="type.BIG">Duże</option>
    </select>
  </div>

  <div class="filter-buttons-container">
    <button class="small-button button" (click)="getFiltering().clearFilter()">Wyczyść</button>
  <button class="small-button button" (click)="getFiltering().searchFilter()">Szukaj</button>
  </div>
</ng-template>

<ng-template #special_lists>
  <div class="expansion-list-header" (click)="toggleSpecialListOpen($event)">
    <span class="list-header-name">Listy</span>
    <div class="filter-button expansion-icon" (click)="toggleSpecialListOpen($event)"></div>
  </div>
  <div id="special-list" class="list border" *ngIf="getState().isSpecialListOpen()">

    <!-- TODO: zrobić sposób zaznaczania specjalnych list -->
    <div [ngClass]="{'selected-list-item': false,
                  'project': true,
                  'list-item':true,
                  'transparent-border':true}" 
                  (click)='onImportantListClick()'>
      <div class="list-item-value">Ważne</div>
    </div>

    <div [ngClass]="{'selected-list-item': false,
                  'project': true,
                  'list-item':true,
                  'transparent-border':true}" 
                  (click)='onTodayListClick()'>
      <div class="list-item-value">Dzisiaj</div>
    </div>
  </div>
</ng-template>

<ng-template #project_lists_container>
  <div class="expansion-list-header" (click)="toggleProjectsListOpen($event)">
    <span class="list-header-name">Projekty</span>
    <div class="filter-button expansion-icon" (click)="toggleProjectsListOpen($event)"></div>
  </div>
  <!-- TODO: zrobić globalny styl do listy oraz do jej elementów-->

    <div id="projects-list"  class="list border" *ngIf="getState().isProjectsListOpen()">
      <div *ngFor='let project of getModel().getProjects()'>
        <ng-container [ngTemplateOutlet]="project_item" [ngTemplateOutletContext]="{$implicit:project}"></ng-container>
      </div>
      <div *ngIf="getState().isAddingOpen()" >
        <ng-container [ngTemplateOutlet]="new_project"></ng-container>
      </div>
    </div>
    <button class="button border" (click)='getAdding().onCreateProjectClick()' 
      *ngIf="!getState().isAddingOpen() && getState().isProjectsListOpen()">
      Dodaj projekt
    </button>

</ng-template>

<ng-template #project_item let-project>
  <div [ngClass]="{'selected-list-item': getModel().isSelectedProject(project),
                    'project': true,
                    'list-item':true,
                    'transparent-border':true}" 
                    (click)='onProjectClick(project)'>
          <div class="list-item-value">{{project.getName()}}</div>
          <div class="list-item-options" 
            (click)='onProjectMenuClick($event, project)'
            [matMenuTriggerFor]="menu">
            ...
          </div>
        </div>     
</ng-template>

<ng-template #new_project>
  <input type="text" class="form-control" id="new-project-name" (keyup)="getAdding().handleAddingNewProjectKeyUp($event)"
        [ngModel]="getAdding().getModel().getNewProjectName()" (ngModelChange)="getAdding().getModel().setNewProjectName($event)">
        <div class="buttons-container">
            <button class="button small-button insert-button" id="save-subtask-button" 
            (click)="getAdding().addNewProject()">Zapisz</button>
            <button class="button small-button insert-button" id="cancel-subtask-button"
            (click)="getAdding().closeAddingNewProject()">Anuluj</button>
        </div>
</ng-template>